# 命令模式

## 定义

命令模式（Command Pattern）是一种**数据驱动**的设计模式，它属于行为型模式。

请求以命令的形式包裹在对象中，并传给调用对象。

调用对象寻找可以处理该命令的合适的对象，并把该命令传给相应的对象，该对象执行命令

命令模式是一个**高内聚**的模式

其定义为：将一个请求封装成一个对象，从而让你使用不同的请求把客户端参数化，对请求排队或者记录请求日志，可以提供命令的**撤销和恢复**功能

### 三个角色

- Receiver接受者角色：该角色就是干活的角色，命令传递到这里是应该被执行的
- Command命令角色：需要执行的所有命令都在这里声明
- Invoker调用者角色：接收到命令，并执行命令

## 使用场景

- 当需要先将一个函数登记上，然后再以后调用此函数时，就需要使用命令模式，其实这就是回调函数
- 有时候需要向某些对象发送请求，但是并不知道请求的接收者是谁，也不知道被请求的操作是什么。此时希望用一种松耦合的方式来设计程序，使得请求发送者和请求接收者能够消除彼此之间的耦合关系

### 例子

拿订餐来说，客人需要向厨师发送请求，

但是完全不知道这些厨师的名字和联系方式，也不知道厨师炒菜的方式和步骤。 

命令模式把客人订餐的请求封装成 command 对象，也就是订餐中的订单对象。

这个对象可以在程序中被四处传递，就像订单可以从服务员手中传到厨师的手中。

这样一来，客人不需要知道厨师的名字，从而解开了请求调用者和请求接收者之间的耦合关系

## 优缺点

### 优点

- 类间解耦：**调用者角色与接收者角色之间没有任何依赖关系**，调用者实现功能时只需调用Command 抽象类的execute方法就可以，不需要了解到底是哪个接收者执行。
- 可扩展性：Command的子类可以非常容易地扩展，而调用者Invoker和高层次的模块Client不产生严 重的代码耦合。
- 命令模式**结合其他模式**会更优秀、
    - 命令模式可以结合责任链模式，实现命令族解析任务
    - 结合模板方法模式，则可以减少 Command子类的膨胀问题

## 缺点

命令模式也是有缺点的，请看Command的子类：如果有N个命令，问题就出来 了，Command的子类就可不是几个，而是N个，**这个类膨胀得非常大**，这个就需要读者在项目中慎重考虑使用。

## 总结

命令模式的意图是**将一个请求封装成一个对象，从而使您可以用不同的请求对客户进行参数化**。

命令模式**主要解决**的问题是在软件系统中，**行为请求者与行为实现者通常是一种紧耦合的关系**，

但某些场合，比如需要对行为进行记录、撤销或重做、事务等处理时，

这种无法抵御变化的紧耦合的设计就不太合适。

在这种情况下，如何将"行为请求者"与"行为实现者"解耦？

将一组行为抽象为对象，可以实现二者之间的松耦合，这是命令模式的使用场景。

**系统需要支持命令的撤销(Undo)操作和恢复(Redo)操作，也可以考虑使用命令模式**

命令模式的实现过程通过调用者调用接受者执行命令，顺序：调用者→接受者→命令